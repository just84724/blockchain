<html>
    <head>
        <meta charset = "utf-8">
        <title>å€å¡Šéˆäº¤æ˜“ç¶²ç«™</title>	
        <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Web3.js -->
  <script src="node_modules/web3/dist/web3.min.js"></script>
       <script type="text/javascript" src="node_modules/web3/dist/web3.min.js">//è¼‰å…¥ Web3.js å‡½å¼åº«ï¼Œé€™æ˜¯ç”¨ä¾†èˆ‡ä»¥å¤ªåŠï¼ˆEthereumï¼‰å€å¡Šéˆäº’å‹•çš„ JavaScript å‡½å¼åº«ã€‚
        //è·¯å¾‘æ˜¯ node_modules/web3/dist/web3.min.jsï¼Œé€™è¡¨ç¤ºä½ å¿…é ˆå…ˆé€é npm å®‰è£é Web3 æ‰èƒ½æ­£å¸¸é‹ä½œã€‚
        </script> 
        <style>
           body.dark {
      background-color: #1f2937;
      color: white;
    }
    .dark input, .dark button {
      background-color: #374151;
      color: white;
      border-color: #6b7280;
    }
     :root {
      --bg-color: #f4f7fa;
      --text-color: #333;
      --card-bg: #fff;
      --card-shadow: rgba(0, 0, 0, 0.1);
      --highlight-color: #1386d3;
      --border-color: #ccc;
      --input-bg: #fff;
    }

    body.dark-mode {
      --bg-color: #1e1e1e;
      --text-color: #eee;
      --card-bg: #2c2c2c;
      --card-shadow: rgba(0, 0, 0, 0.3);
      --highlight-color: #9b59b6;
      --border-color: #444;
      --input-bg: #3c3c3c;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 40px;
      transition: all 0.3s ease;
    }

    .container {
      max-width: 600px;
      margin: auto;
    }

    .card {
      background-color: var(--card-bg);
      padding: 20px 30px;
      margin-bottom: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px var(--card-shadow);
      transition: all 0.3s ease;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid var(--border-color);
      background-color: var(--input-bg);
      color: var(--text-color);
      border-radius: 5px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 16px;
      background-color: var(--highlight-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      opacity: 0.9;
    }

    p {
      background-color: var(--input-bg);
      padding: 10px;
      border-left: 5px solid var(--highlight-color);
      border-radius: 5px;
      margin-top: 10px;
      word-break: break-word;
    }

    .theme-toggle {
      text-align: right;
      margin-bottom: 20px;
    }

    .theme-toggle button {
      background-color: transparent;
      border: 2px solid var(--highlight-color);
      color: var(--highlight-color);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
    }

    .theme-toggle button:hover {
      background-color: var(--highlight-color);
      color: white;
    }
        </style>
      </head>  

        <script type="text/javascript">
          
          var web3 = new Web3(Web3.givenProvider || "http://127.0.0.1:7545"); //é€£æ¥ganacheçš„ç«¯å£ï¼Œåˆå§‹åŒ–ä¸€å€‹ Web3 ç‰©ä»¶ã€‚ Web3.givenProvider æ˜¯ç€è¦½å™¨å…§éƒ¨çš„ Ethereum æä¾›è€…ï¼Œä¾‹å¦‚ MetaMaskã€‚ 
          // å¦‚æœæ²’æœ‰ç€è¦½å™¨æä¾›è€…ï¼Œå°±ç”¨æœ¬åœ°çš„ Ganache ç¯€é»ï¼ˆhttp://127.0.0.1:7545ï¼‰ä½œç‚ºå‚™ç”¨ã€‚ é€™è¡¨ç¤ºå®ƒæ”¯æ´ä½ ç”¨ MetaMaskï¼Œä¹Ÿèƒ½åœ¨æœ¬åœ°æ¸¬è©¦ç”¨ Ganacheã€‚

          async function start() {
            const errorDiv = document.getElementById("errorMessage");

          if (typeof window.ethereum === 'undefined') {
          errorDiv.style.display = "block";
          errorDiv.textContent = "âš ï¸ è«‹å…ˆå®‰è£ MetaMask æ“´å……å¥—ä»¶ï¼Œæ‰èƒ½ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚";
          return;
          }

            try {
              const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
              const defaultAccount = accounts[0];
              //let defaultAccount = await web3.eth.getCoinbase();  //å®šç¾©ä¸€å€‹éåŒæ­¥å‡½æ•¸ start()ï¼Œå–å¾—é è¨­å¸³æˆ¶ defaultAccount æŸ¥è©¢é€™å€‹å¸³æˆ¶çš„é¤˜é¡ï¼ˆå–®ä½æ˜¯ Weiï¼‰
              let balance = await web3.eth.getBalance(defaultAccount);
              
              document.getElementById("account").textContent = defaultAccount;
              document.getElementById("balance").textContent = web3.utils.fromWei(balance, "ether");
              //var html_account = document.getElementById("account");//å¸³æˆ¶åœ°å€å’Œé¤˜é¡é¡¯ç¤ºåœ¨é é¢ä¸Šã€‚ 
              //var html_balance = document.getElementById("balance");
              html_account.textContent = defaultAccount;
              html_balance.textContent = web3.utils.fromWei(balance, "ether"); //fromWei(balance, "ether")ï¼šå°‡å–®ä½å¾ Weiï¼ˆæœ€å°å–®ä½ï¼‰è½‰æˆ Etherï¼ˆETHï¼‰
            } catch(err) {
              console.error("Error:", err);  //å¦‚æœæœ‰éŒ¯èª¤ï¼ˆæ¯”å¦‚æ²’é€£ä¸Š MetaMaskï¼‰ï¼Œå°±å°å‡ºéŒ¯èª¤è³‡è¨Šã€‚
              errorDiv.style.display = "block";
            }
          }
          
          //window.addEventListener("load", start); //åœ¨ç¶²é è¼‰å…¥æ™‚ï¼Œè‡ªå‹•åŸ·è¡Œ start() å‡½æ•¸ã€‚
          window.addEventListener('load', async () => {
             if (typeof window.ethereum !== 'undefined') {
                await start();
           } else {
               alert("è«‹å®‰è£ MetaMaskï¼");
         }
      });


        
          async function sendTransaction() {
          const toAddress = document.getElementById("toAddress").value; // å¾è¼¸å…¥æ¬„ä½å–å¾—æ”¶æ¬¾åœ°å€
          const status = document.getElementById("txStatus"); // ç”¨ä¾†é¡¯ç¤ºäº¤æ˜“ç‹€æ…‹çš„ HTML å…ƒç´ 
  
    try {
      const accounts = await web3.eth.getAccounts();  // å–å¾—ä½¿ç”¨è€…çš„å¸³æˆ¶
      const from = accounts[0]; // é€šå¸¸æ˜¯é è¨­å¸³æˆ¶ï¼ˆç¬¬ä¸€å€‹ï¼‰

      // ç™¼é€äº¤æ˜“
      const tx = await web3.eth.sendTransaction({
        from: from,
        to: toAddress,
        value: web3.utils.toWei("0.01", "ether") // å°‡ 0.01 ETH è½‰æˆ Weiï¼ˆæœ€å°å–®ä½ï¼‰
      });
       
      status.textContent = `âœ… æˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š${tx.transactionHash}`;      // é¡¯ç¤ºæˆåŠŸè¨Šæ¯èˆ‡äº¤æ˜“ hash
    } catch (err) {
      console.error("Transaction failed:", err);
      status.textContent = `âŒ ç™¼é€å¤±æ•—ï¼š${err.message}`;
    }
  }

  async function readValue() {
    try {
      const result = await contract.methods.get().call();  // å‘¼å« get() å‡½å¼ï¼Œä¸æœƒèŠ±è²» gas
      document.getElementById("contractValue").textContent = "ğŸ“¥ ç›®å‰å„²å­˜å€¼ï¼š" + result;
    } catch (err) {
      console.error(err);
    }
  }
  
  async function writeValue() {
    try {
      const value = document.getElementById("newValue").value; // å¾è¼¸å…¥æ¬„ä½å–å¾—æ–°å€¼
      const accounts = await web3.eth.getAccounts(); // å–å¾—ä½¿ç”¨è€…å¸³æˆ¶
  
      const receipt = await contract.methods.set(value).send({ from: accounts[0] }); // å‘¼å«åˆç´„ä¸­çš„ set å‡½å¼
      document.getElementById("writeStatus").textContent = "âœ… å¯«å…¥æˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š" + receipt.transactionHash; // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
    } catch (err) {
      console.error(err);
      ddocument.getElementById("writeStatus").textContent = "âŒ å¯«å…¥å¤±æ•—ï¼š" + err.message;
    }
  }


const contractABI = [ //åˆç´„ ABI å’Œåœ°å€
    {
      "constant": false,
      "inputs": [{"name": "_value", "type": "uint256"}],
      "name": "set",
      "outputs": [],
      "type": "function"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "get",
      "outputs": [{"name": "", "type": "uint256"}],
      "type": "function"
    }
  ];
  
  // ç”¨ä½ è‡ªå·±åˆç´„éƒ¨ç½²å¾Œçš„åœ°å€
  const contractAddress = "0x44106369461AdC1Da05Ce0d30F11553DDf3351f7";
  
  const contract = new web3.eth.Contract(contractABI, contractAddress);   
  
        </script>
      </head>
    <body>
      <body class="transition-colors duration-300">
        <div class="container mt-5">
      
          <!-- ä¸»æ¨™é¡Œèˆ‡ä¸»é¡Œåˆ‡æ› -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-3xl font-bold">ğŸ”— Hello Web3</h1>
          </div>
      
          <!-- éŒ¯èª¤æç¤º -->
          <div id="errorMessage" class="alert alert-danger d-none" role="alert"></div>
      
          <!-- å¸³æˆ¶èˆ‡é¤˜é¡ -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">ğŸ‘¤ å¸³æˆ¶è³‡è¨Š</h5>
              <p>åœ°å€ï¼š<span id="account" class="font-mono"></span></p>
              <p>é¤˜é¡ï¼š<span id="balance" class="font-mono"></span> ETH</p>
            </div>
          </div>
      
          <!-- ç™¼é€äº¤æ˜“ -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">ğŸ’¸ ç™¼é€äº¤æ˜“</h5>
              <input type="text" id="toAddress" class="form-control mb-2" placeholder="æ”¶æ¬¾åœ°å€" />
              <button onclick="sendTransaction()" class="btn btn-primary">ç™¼é€ 0.01 ETH</button>
              <p id="txStatus" class="mt-2 text-sm"></p>
            </div>
          </div>
      
          <!-- åˆç´„äº’å‹• -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">ğŸ“œ åˆç´„äº’å‹•</h5>
              <button onclick="readValue()" class="btn btn-secondary mb-2">è®€å–å€¼</button>
              <p id="contractValue"></p>
      
              <input type="number" id="newValue" class="form-control mb-2" placeholder="æ–°å€¼" />
              <button onclick="writeValue()" class="btn btn-success">å¯«å…¥å€¼</button>
              <p id="writeStatus" class="mt-2 text-sm"></p>
            </div>
          </div>
      
        </div>
		<!-- <h3>ç™¼é€äº¤æ˜“</h3>
		<input type="text" id="toAddress" placeholder="Recipient Address">
		<button onclick="sendTransaction()">ç™¼é€ 0.01 ETH</button>
		<p id="txStatus"></p>
        <h1>å¸³æˆ¶: <span id="account"></span></h1>
        <h3>ä½ æœ‰ <span id="balance"></span> Ether</h3>
        <h3>åˆç´„äº¤äº’</h3>
        <button onclick="readValue()">è®€å–å€¼</button>
        <p id="contractValue"></p>

        <input type="number" id="newValue" placeholder="New Value">
        <button onclick="writeValue()">å¯«å…¥å€¼</button>
<p id="writeStatus"></p> -->
    </body>
</html>